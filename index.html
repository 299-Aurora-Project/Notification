/* v t1.1.3 */
async function testNotification() {
    console.log("Notification button clicked");
    
    // モバイルのブラウザ内では window.Notification が undefined になることがあります
    // その場合、ServiceWorkerRegistration からアプローチします
    const hasServiceWorker = 'serviceWorker' in navigator;
    const hasNotification = 'Notification' in window;

    if (!hasNotification && !hasServiceWorker) {
        alert("This browser/OS does not support notifications.");
        return;
    }

    // iOS/Android 向けの権限リクエスト
    let permission = Notification.permission;
    if (permission === "default") {
        permission = await Notification.requestPermission();
    }

    console.log("Permission status:", permission);

    if (permission === "granted") {
        try {
            const registration = await navigator.serviceWorker.ready;
            // 24時間以内の重複通知を防ぐため、テストボタンでも日付チェックを無視して強制発信
            await registration.showNotification("Aurora Forecast Pro", {
                body: "Mobile notification is working!",
                icon: "icon.png",
                badge: "icon.png",
                vibrate: [200, 100, 200] // モバイル用の振動パターン
            });
        } catch (error) {
            console.error("Mobile SW Error:", error);
            alert("Notification failed: Ensure you have added this app to your Home Screen.");
        }
    } else {
        alert(`Permission ${permission}: Please enable notifications in your OS settings.`);
    }
}
